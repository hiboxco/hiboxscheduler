"use strict";var TIMEOUT=150,BASE_NEEDLE_ANGLE=22.5,START_NEEDLE_MOVE_ANGLE=21,END_NEEDLE_MOVE_ANGLE=29,NEEDLE_ANGLE_INCREMENT=4.5,DECIMAL_MULTIPLIER=1e3,CLOSE_WIDGET="--close-widget--",cookies={SHOWN:"ap3shown",SHOWN_IN_CURRENT_SESSION:"ap3sess",DISMISSED:"ap3dm",CONVERTED:"ap3converted"},frequencies={ALWAYS:"always",UNTIL_DIMISSED_OR_CONVERTED:"until dismissed",ONCE_PER_SESSIONS_OR_UNTIL_CONVERTED:"once per session",ONLY_ONCE:"only once",UNTIL_KNOWN:"until they are known"},embeddedFormSubmission={},isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),getTimeFromSeconds=function(seconds,display){return seconds<=0?{days:0,hours:0,minutes:0,seconds:0}:-1!==display.indexOf("DD")?{days:Math.floor(seconds/86400),hours:Math.floor(seconds%86400/3600),minutes:Math.floor(seconds%3600/60),seconds:Math.floor(seconds%60)}:-1!==display.indexOf("HH")?{days:0,hours:Math.floor(seconds/3600),minutes:Math.floor(seconds%3600/60),seconds:Math.floor(seconds%60)}:-1!==display.indexOf("MM")?{days:0,hours:0,minutes:Math.floor(seconds/60),seconds:Math.floor(seconds%60)}:{days:0,hours:0,minutes:0,seconds:seconds}};if(!("SubmitEvent"in self&&"submitter"in SubmitEvent.prototype)){var submitter=Symbol.for("submitter");Event[submitter]=null;var submitterSelector="input[type=submit], input[type=image], input[type=button], button";Object.defineProperty(Event.prototype,"submitter",{get:function(){if("submit"===this.type){var node=Event[submitter],form=this.target;return node&&form.contains(node)||(node=form.querySelector(submitterSelector)),node||form}},set:function(value){"submit"===this.type&&(this.submitter=value)}}),self.addEventListener("click",function(event){var _node$closest,_node$closest2,node=event.composedPath()[0],closest=null!==(_node$closest=null===(_node$closest2=node.closest)||void 0===_node$closest2?void 0:_node$closest2.call(node,submitterSelector))&&void 0!==_node$closest?_node$closest:null;Event[submitter]=closest},!0)}String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{value:function(search,rawPos){var pos=0<rawPos?0|rawPos:0;return this.substring(pos,pos+search.length)===search}}),Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(s){var el=this;do{if(Element.prototype.matches.call(el,s))return el;el=el.parentElement||el.parentNode}while(null!==el&&1===el.nodeType);return null}),"remove"in Element.prototype||(Element.prototype.remove=function(){this.parentNode&&this.parentNode.removeChild(this)});var jsonFromXhr=function(url,method,requestPayload,onFetched){var req=new XMLHttpRequest;req.open(method,url),req.send(JSON.stringify(requestPayload)),req.onload=function(){var jsonResponse=JSON.parse(req.responseText);onFetched(jsonResponse)}};function readCookie(key){for(var parts=document.cookie.split(";"),i=0;i<parts.length;i++){var cookie=parts[i];if(cookie&&(cookie=cookie.trimStart()).startsWith(key+"="))return cookie.split("=")[1]}return""}function removeCookie(key){document.cookie=key+"=; path=/; expires=Thu, 01 Jan 1970 00:00:01 GMT;"}function convertLegacyCookies(widget){var legacy=readCookie(widget.id);if(legacy)return"shown"!==legacy?ap3c.setFrequencyCookie(cookies.SHOWN_IN_CURRENT_SESSION,widget.id,!0):ap3c.setFrequencyCookie(cookies.SHOWN,widget.id),removeCookie(widget.id),!0}function isKnownSession(){var sessionID=ap3c.getCookie();if(!sessionID)return!1;for(var b64Encoded="",i=0;i<sessionID.length;i++){var ch=sessionID[i];switch(ch){case"_":b64Encoded+="/";break;case"-":b64Encoded+="+";break;default:b64Encoded+=ch}}var mod=b64Encoded.length%4;2<=mod&&mod<=3&&(b64Encoded+="=".repeat(4-mod));try{var decoded=atob(b64Encoded);if(decoded&&0<decoded.length)return 0==decoded.charCodeAt(0)}catch(err){return console.error(err),!0}return!1}history.pushState=function(f){return function(){var ret=f.apply(this,arguments);return window.dispatchEvent(new Event("pushstate")),window.dispatchEvent(new Event("locationchange")),ret}}(history.pushState),history.replaceState=function(f){return function(){var ret=f.apply(this,arguments);return window.dispatchEvent(new Event("replacestate")),window.dispatchEvent(new Event("locationchange")),ret}}(history.replaceState),window.addEventListener("popstate",function(){window.dispatchEvent(new Event("locationchange"))}),ap3c.init=function(uniqueID,apiHost,options){if(!uniqueID)throw new Error("Autopilot tracking code init failed with invalid uniqueID");if(!apiHost)throw new Error("Autopilot tracking code init failed with invalid API host");if(ap3c.uniqueID&&ap3c.apiHost)throw new Error("Autopilot tracking code has already been initialized");"https://capture-api.autopilotapp.com/"===apiHost&&(apiHost="https://capture-api.ap3prod.com/"),ap3c.payloadEnrichers=[],ap3c.staticActions=["shopify_subscribe","shopify_product_viewed","shopify_product_added_to_cart"],ap3c.widgetsFuncs={popup:ap3c._generalWidget,bar:ap3c._generalWidget,notification:ap3c._generalWidget,takeover:ap3c._generalWidget,form:ap3c._generalWidget,"spin-the-wheel":ap3c._generalWidget,banner:ap3c._generalWidget,shopify_waiting_on_stock:ap3c._shopifyWaitingOnStockWidget},ap3c.staticActionsFuncs={shopify_subscribe:ap3c._shopifySubscribeAction,shopify_product_viewed:ap3c._shopifyProductViewedAction,shopify_product_added_to_cart:ap3c._shopifyProductAddedToCartAction},ap3c.processStaticActions=function(){if(ap3c.staticActions)for(var i=0;i<ap3c.staticActions.length;i++)ap3c.staticActionsFuncs[ap3c.staticActions[i]].canExecute&&ap3c.staticActionsFuncs[ap3c.staticActions[i]].canExecute()&&ap3c.staticActionsFuncs[ap3c.staticActions[i]].execute()};try{ap3c.uniqueID=uniqueID,ap3c.apiHost=apiHost,options&&(options.cookieDomains&&(ap3c.cookieDomains=options.cookieDomains,"h"===options.link&&ap3c.hLinks(),"g"===options.link&&ap3c.gLinks()),ap3c.disableWidgets=options.disableWidgets),ap3c.processStaticActions(),ap3c.callAfterInit=ap3c._processWidgets,window.addEventListener("locationchange",function(){ap3c._processWidgets()}),window.onload=function(){var bodyList=document.querySelector("body");new MutationObserver(function(mutations){mutations.forEach(function(mutation){if("childList"===mutation.type)for(var mIdx=0;mIdx<mutation.addedNodes.length;mIdx++)if(mutation.addedNodes[mIdx].innerHTML&&-1!=mutation.addedNodes[mIdx].innerHTML.indexOf("ap3w-embeddable-form")){ap3c._processWidgets(!0);break}})}).observe(bodyList,{childList:!0,subtree:!0})}}catch(e){console.error("Error initializing Autopilot tracking code",e)}},ap3c.checkCookieDomainMatch=function(domain){if(!ap3c.cookieDomains||!domain)return null;for(var i=0;i<ap3c.cookieDomains.length;i++)if(domain.match(ap3c.cookieDomains[i]))return ap3c.cookieDomains[i];return!1},ap3c.checkCurrentDomainMatch=function(cookieDomain){return cookieDomain?!!window.location.href.match(cookieDomain):null},ap3c.hLinks=function(){var c=ap3c.getCookie();if(c)for(var anchors=document.getElementsByTagName("a"),i=0;i<anchors.length;i++){var cookieDomain=ap3c.checkCookieDomainMatch(anchors[i].href);cookieDomain&&!ap3c.checkCurrentDomainMatch(cookieDomain)&&(4<anchors[i].href.indexOf("#")||(anchors[i].href=anchors[i].href+"#ap3c"+c))}},ap3c.gLinks=function(){var c=ap3c.getCookie();if(c)for(var anchors=document.getElementsByTagName("a"),i=0;i<anchors.length;i++){var cookieDomain=ap3c.checkCookieDomainMatch(anchors[i].href);if(cookieDomain&&!ap3c.checkCurrentDomainMatch(cookieDomain))if(4<anchors[i].href.indexOf("?"))anchors[i].href=anchors[i].href+"&ap3c="+c;else{var parts=anchors[i].href.split("#");1<parts.length?anchors[i].href=parts[0]+"?ap3c="+c+"#"+parts[1]:anchors[i].href=anchors[i].href+"?ap3c="+c}}},ap3c.getCookie=function(){var c=document.cookie.match(new RegExp("(^| )ap3c=([^;]+)")),cookie=c&&c[2]||"";return"undefined"===cookie?null:cookie},ap3c.setCookie=function(sessionId){var domain="",expires=new Date;if(expires.setFullYear(expires.getFullYear()+1),ap3c.cookieDomains)for(var i=0;i<ap3c.cookieDomains.length;i++){var d=ap3c.cookieDomains[i];d.startsWith(".")&&(d=d.substr(1)),-1!=window.location.host.indexOf(d)&&(domain=ap3c.cookieDomains[i])}var cookie="ap3c="+sessionId+";path=/;expires="+expires.toUTCString();domain&&(cookie+=";domain="+domain),document.cookie=cookie},ap3c.readCurrentState=function(widgets){if(widgets){for(var i=0;i<widgets.length;i++)convertLegacyCookies(widgets[i]);removeCookie("ap3known");var parts=document.cookie.split(";"),ap3Cookies={};for(i=0;i<parts.length;i++){if((cookie=parts[i].trim()).startsWith("ap3")){var keyValue=cookie.split("=");2==keyValue.length&&(ap3Cookies[keyValue[0].trimEnd()]=keyValue[1].trimStart())}}var state={IS_KNOWN_SESSION:isKnownSession()};for(var key in cookies){var cookie;if(cookie=ap3Cookies[cookies[key]]){var widgetIDs=cookie.split(","),parsed={};for(i=0;i<widgetIDs.length;i++)parsed[widgetIDs[i]]=!0;state[key]=parsed}else state[key]={}}return state}},ap3c.setFrequencyCookie=function(key,widgetID,isSessionCookie){var cookie=readCookie(key);if(cookie?cookie.includes(widgetID)||(cookie+=","+widgetID):cookie=widgetID,isSessionCookie)document.cookie=key+"="+cookie+";path=/";else{var expires=new Date;expires.setFullYear(expires.getFullYear()+1),document.cookie=key+"="+cookie+";expires="+expires.toUTCString()+";path=/"}},ap3c.detectTouch=function(){var prefixes=" -webkit- -moz- -o- -ms- ".split(" ");return!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)||function(query){return!!window.matchMedia(query).matches}(["(",prefixes.join("touch-enabled),("),"heartz",")"].join(""))},ap3c.injectCustomFonts=function(fontUrls){fontUrls.forEach(function(font){if(font&&!document.getElementById(font.family)){var link=document.createElement("link");link.id=font,link.rel="stylesheet",link.type="text/css",link.href=font,link.media="all",document.head.appendChild(link)}})},ap3c.getShopifyProductCurrentVariantId=function(){var variantIdFromUrl=new URLSearchParams(window.location.search).get("variant"),variantIdFromShopify=window.ShopifyAnalytics.meta.selectedVariantId,variantIdByDefault=ap3c.shopifyProductDefaultVariantId;return variantIdFromUrl||variantIdFromShopify||variantIdByDefault};var widgetsAccepted=[];ap3c.track=function(options,callback){var now=new Date;if(!options||!options.cw||"widget_dismissed"!==options.cw.type||-1===widgetsAccepted.indexOf(options.cw.widget_id))try{var loc=window.location.href,qs=loc.split("?"),params={};if(1<qs.length){var qsp=qs[1].split("&");for(var i in qsp)if("string"==typeof qsp[i]){var kv=qsp[i].split("=");params[kv[0]]=decodeURIComponent(kv[1])}}var hp=loc.split("#ap3c"),ap3ch=1<hp.length?hp[1]:null,payload={s:ap3c.getCookie()||params.ap3c||ap3ch||null,c:options.contactId||params.apcid||null,ei:options.ei||null,cw:options.cw,sh:options.sh,wc:options.wc,ps:options.ps,e:options.email||params.email||null,first:window.AP3_FIRST_NAME||options.first||params.first||null,last:window.AP3_LAST_NAME||options.last||params.last||null,h:ap3c.uniqueID,u:loc,t:document.title,r:document.referrer,us:params.utm_source,um:params.utm_medium,un:params.utm_campaign,ut:params.utm_term,uc:params.utm_content,l:navigator.language,sx:window.screen.width,sy:window.screen.height,sr:window.devicePixelRatio,v:options&&options.v||0,ts:!!ap3c.detectTouch(),id:options.widget_id,ag:!!ap3c.getCookie()||options.accepted,discount_id:options.discount_id,rc:options.rc};if(ap3c.payloadEnrichers)for(i=0;i<ap3c.payloadEnrichers.length;i++)payload=ap3c.payloadEnrichers[i](payload,options);var apiPath=options.apiPath||"-/events/page-event",url=ap3c.apiHost+apiPath;jsonFromXhr(url,"POST",payload,function(res){callback&&callback(res),res.session_id&&(ap3c.setCookie(res.session_id),res.gdpr_widget_id&&(document.cookie=res.gdpr_widget_id+"="+res.session_id+";path=/")),res.widgets&&localStorage.setItem("ap_capture_widgets",JSON.stringify({expiry:now.getTime()+3e5,widgets:res.widgets,enabled_gdpr:res.enabled_gdpr,recaptcha_site_key:ap3c.recaptcha_site_key,country_code:ap3c.country_code})),options&&options.cw&&"widget_shown"!==options.cw.type&&options.cw.widget_id&&-1===widgetsAccepted.indexOf(options.cw.widget_id)&&widgetsAccepted.push(options.cw.widget_id),options&&options.sh&&options.sh.widget_id&&-1===widgetsAccepted.indexOf(options.sh.widget_id)&&widgetsAccepted.push(options.sh.widget_id),ap3c.callAfterInit&&(ap3c.callAfterInit.call(),ap3c.callAfterInit=void 0)})}catch(e){console.error("Error running Autopilot track page",e)}},ap3c._processWidgets=function(reprocessEmbeddedForm){var now=new Date;try{var data=localStorage.getItem("ap_capture_widgets");if(data){var item=JSON.parse(data);if(now.getTime()<item.expiry){if(_widgets=item.widgets,ap3c.recaptcha_site_key=item.recaptcha_site_key,ap3c.country_code=item.country_code,reprocessEmbeddedForm){var _widgets=item.widgets.filter(function(w){return"form"===w.type});embeddedFormSubmission={}}return void ap3c._runWidgets(_widgets,item.hasLogo,reprocessEmbeddedForm)}localStorage.removeItem("ap_capture_widgets")}var url=ap3c.apiHost+"-/widgets/get",loc=window.location.href,qs=loc.split("?"),params={};if(1<qs.length){var qsp=qs[1].split("&");for(var i in qsp){var kv=qsp[i].split("=");params[kv[0]]=decodeURIComponent(kv[1])}}var hp=loc.split("#ap3c"),ap3ch=1<hp.length?hp[1]:null,payload={s:ap3c.getCookie()||params.ap3c||ap3ch||null,c:params.apcid||null,e:params.email||null,h:ap3c.uniqueID};jsonFromXhr(url,"POST",payload,function(resp){var widgets=resp.widgets||[],hasLogo=resp.has_logo;if(resp.session_id&&ap3c.setCookie(resp.session_id),localStorage.setItem("ap_capture_widgets",JSON.stringify({expiry:now.getTime()+3e5,widgets:widgets,hasLogo:hasLogo,enabled_gdpr:resp.enabled_gdpr,recaptcha_site_key:resp.recaptcha_site_key,country_code:resp.country_code})),_widgets=widgets,reprocessEmbeddedForm)var _widgets=widgets.filter(function(w){return"form"===w.type});ap3c.recaptcha_site_key=resp.recaptcha_site_key,ap3c.country_code=resp.country_code,ap3c._runWidgets(_widgets,hasLogo,reprocessEmbeddedForm)})}catch(e){console.error(e)}},ap3c._runWidgets=function(widgets,hasLogo,reprocessEmbeddedForm){if(widgets&&0!==widgets.length){widgets.sort(function(a,b){return a.priority-b.priority});var state=ap3c.readCurrentState(widgets),hasRecaptcha=!1,onloadCallbackFuncBody="";if(widgets.forEach(function(widget){if(-1===window.location.href.indexOf(widget.id))if(ap3c.widgetsFuncs[widget.type]){if(widget&&widget.has_recaptcha&&(hasRecaptcha=!0,onloadCallbackFuncBody+="if (document.getElementById('ap3w-recaptcha-v2-"+widget.id+"')){ grecaptcha.render('ap3w-recaptcha-v2-"+widget.id+"', { 'sitekey': '"+ap3c.recaptcha_site_key+"', 'callback': verifyCallback, }); } "),ap3c.widgetsFuncs[widget.type].canExecute(widget,state))if(widget&&widget.type&&"form"===widget.type)ap3c.widgetsFuncs[widget.type].injectEmbeddableForm(widget,reprocessEmbeddedForm);else try{ap3c.widgetsFuncs[widget.type].execute(widget,hasLogo)}catch(err){console.error(err)}}else console.warn("Missing widget:",widget.type)}),hasRecaptcha){var callbackScript=document.createElement("script");callbackScript.innerHTML=" var verifyCallback = function(response) { ap3c.recaptcha = response; }; var recaptchaOnloadCallback = function () { "+onloadCallbackFuncBody+" }; ",document.head.appendChild(callbackScript);var script=document.createElement("script");script.src="https://www.google.com/recaptcha/api.js?onload=recaptchaOnloadCallback&render=explicit",script.async=!0,script.defer=!0,document.head.appendChild(script)}}},ap3c.getFormFieldsData=function(widget,inputClassName,selectedOptions,container){var isEmbeddableForm="ap3w-form-input"===inputClassName,formFields=container.getElementsByClassName(inputClassName),fields=[];selectedOptions=selectedOptions||[];for(var index=0;index<formFields.length;index++){var value=0<formFields[index].getElementsByTagName("input").length&&formFields[index].getElementsByTagName("input")[0].value;if(0<formFields[index].getElementsByTagName("input").length){if("number"===formFields[index].getElementsByTagName("input")[0].type&&(value="any"===formFields[index].getElementsByTagName("input")[0].step?parseInt(+formFields[index].getElementsByTagName("input")[0].value*DECIMAL_MULTIPLIER):+formFields[index].getElementsByTagName("input")[0].value),"checkbox"===formFields[index].getElementsByTagName("input")[0].type&&(value=formFields[index].getElementsByTagName("input")[0].checked),"tel"===formFields[index].getElementsByTagName("input")[formFields[index].getElementsByTagName("input").length-1].type||formFields[index].getElementsByTagName("input")[0].lastElementChild&&"tel"===formFields[index].getElementsByTagName("input")[0].lastElementChild.type){var areaCodeInput=document.getElementById("ap3w-input-areacode-"+widget.id),phoneNumberInput=document.getElementById("ap3w-input-phone-"+widget.id);value=areaCodeInput&&""!==areaCodeInput.value?0===areaCodeInput.value.indexOf("+")?{c:areaCodeInput.value,n:phoneNumberInput.value}:{c:"+"+areaCodeInput.value,n:phoneNumberInput.value}:{n:phoneNumberInput.value}}if("date"===formFields[index].getElementsByTagName("input")[0].type||"date"===formFields[index].getElementsByTagName("input")[0].name){var dateString=formFields[index].getElementsByTagName("input")[0].value;if(dateString)value={year:+dateString.substr(0,4),month:+dateString.substr(5,2),day:+dateString.substr(8,2)};else value=void 0}if("datetime-local"===formFields[index].getElementsByTagName("input")[0].type){var inputDate=formFields[index].getElementsByTagName("input")[0].value;if(inputDate)value=new Date(inputDate).toISOString();else value=void 0}}if(-1!==formFields[index].lastElementChild.className.indexOf("ap3w-input-select-list")||-1!==formFields[index].lastElementChild.className.indexOf("ap3w-form-input-select-list")){if(isEmbeddableForm)var listId=formFields[index].lastElementChild.dataset.newListId;else listId=formFields[index].lastElementChild.dataset.listId;value=selectedOptions&&selectedOptions[listId]&&selectedOptions[listId].length?selectedOptions[listId]:-1!==formFields[index].lastElementChild.dataset.selectType.indexOf("multi_select")?[]:void 0}if(-1!==formFields[index].lastElementChild.className.indexOf("ap3w-form-input-select-unstyled")){selectedOptions=formFields[index].lastElementChild.selectedOptions;var _selectedOpts=[];if(formFields[index].lastElementChild.selectedOptions&&formFields[index].lastElementChild.selectedOptions.length)for(var i=0;i<selectedOptions.length;i++)_selectedOpts.push(selectedOptions[i].value);value=_selectedOpts,formFields[index].lastElementChild.multiple||(value=_selectedOpts[0])}0<formFields[index].getElementsByTagName("textarea").length&&(value=formFields[index].getElementsByTagName("textarea")[0].value),fields.push({field_id:formFields[index].dataset.fieldId,value:value,merge_strategy:formFields[index].dataset.mergeStrategy,required:formFields[index].lastElementChild.dataset.required})}return fields},ap3c._generalWidget={countdownInterval:void 0,selectInputsInitialized:!1,ttl:36e5,localStorageKey:"ap_widgets_",canExecute:function(widget,state){var data=localStorage.getItem(this.localStorageKey+widget.id);if(data){var item=JSON.parse(data);if((new Date).getTime()<item.expiry)return!1}return function(widget,state){var showOnClick=widget.when&&"click"===widget.when.selection;if(ap3c.disableWidgets||!widget.page)return!1;var showBasedOnFrequency=!0;switch(widget.frequency){case frequencies.ALWAYS:break;case frequencies.UNTIL_KNOWN:showBasedOnFrequency=!state.IS_KNOWN_SESSION;break;case frequencies.UNTIL_DIMISSED_OR_CONVERTED:showBasedOnFrequency=!state.CONVERTED[widget.id]&&!state.DISMISSED[widget.id];break;case frequencies.ONLY_ONCE:showBasedOnFrequency=!state.SHOWN_IN_CURRENT_SESSION[widget.id]&&!state.SHOWN[widget.id]&&!state.DISMISSED[widget.id];break;case frequencies.ONCE_PER_SESSIONS_OR_UNTIL_CONVERTED:showBasedOnFrequency=!state.CONVERTED[widget.id]&&!state.SHOWN_IN_CURRENT_SESSION[widget.id]}if(!showOnClick&&!showBasedOnFrequency)return!1;if(widget.page.selection&&"any"===widget.page.selection)return!0;var currentUrl=window.location.href,result=!1;if(widget.page.filter){var orCondition=widget.page.filter.$or,andCondition=widget.page.filter.$and,pageCondition=orCondition||andCondition;if(pageCondition)for(var filterIndex=0;filterIndex<pageCondition.length;filterIndex++){var v=pageCondition[filterIndex],filter=Object.keys(v)[0];switch(filter){case"$str::is":var isMatch=v[filter].value.toLowerCase()===currentUrl.toLowerCase();result=andCondition?isMatch:result||isMatch;break;case"$str::is_not":var isNotMatch=v[filter].value.toLowerCase()!==currentUrl.toLowerCase();result=andCondition?isNotMatch:result||isNotMatch;break;case"$str::starts":var isStartMatch=currentUrl.toLowerCase().startsWith(v[filter].value.toLowerCase());result=andCondition?isStartMatch:result||isStartMatch;break;case"$str::ends":var isEndMatch=currentUrl.toLowerCase().endsWith(v[filter].value.toLowerCase());result=andCondition?isEndMatch:result||isEndMatch;break;case"$str::contains":var isContainsMatch=-1!==currentUrl.toLowerCase().indexOf(v[filter].value.toLowerCase());result=andCondition?isContainsMatch:result||isContainsMatch;break;case"$str::does_not_contain":var isDoesNotContainMatch=-1===currentUrl.toLowerCase().indexOf(v[filter].value.toLowerCase());result=isContainsMatch?isDoesNotContainMatch:result||isDoesNotContainMatch}if(andCondition&&!result)break}}return"exclude"===widget.page.selection?!result:result}(widget,state)&&function(widget){return!!widget.where}(widget)&&function(widget){return!!widget.page&&!!(!widget.page.device||"all"===widget.page.device||"mobile"===widget.page.device&&isMobile||"desktop"===widget.page.device&&!isMobile)}(widget)},execute:function(widget,hasLogo){var inject=this.inject.bind(this);"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){inject(widget,hasLogo)}):inject(widget,hasLogo)},copyToClipboard:function(value){var tempInput=document.createElement("input");tempInput.value=value,tempInput.style.opacity=0,document.body.appendChild(tempInput),tempInput.select(),document.execCommand("copy"),document.body.removeChild(tempInput)},hide:function(widget,templateName){var shownOnClick=widget.when&&"click"===widget.when.selection,widgetContainer=document.getElementById(widget.id);if(templateName)var widgetTemplate=document.getElementById(widget.id+"-"+templateName);else widgetTemplate=widgetContainer&&widgetContainer.children&&widgetContainer.children[0];var videoIframes=document.getElementsByClassName("ap3w-youtube-video");if(videoIframes)for(var i=0;i<videoIframes.length;i++)videoIframes[i].contentWindow.postMessage('{"event":"command","func":"stopVideo","args":""}',"*");if(widgetTemplate&&widgetTemplate.children&&-1!==widgetTemplate.children[0].className.indexOf("ap3w-wrapper"))for(var wrapperChildren=widgetTemplate.children[0].children,index=0;index<wrapperChildren.length;index++)wrapperChildren[index].classList.length&&wrapperChildren[index].classList.remove("ap3w-show");else if(widgetTemplate&&widgetTemplate.children)for(index=0;index<widgetTemplate.children.length;index++)widgetTemplate.children[index].classList.length&&widgetTemplate.children[index].classList.remove("ap3w-show");setTimeout(function(){widgetTemplate&&(widgetTemplate.style.display="none"),widgetContainer&&(templateName||(widgetContainer.style.display="none"),shownOnClick||widgetContainer.remove())},TIMEOUT),widget.frequency===frequencies.UNTIL_DIMISSED_OR_CONVERTED&&ap3c.setFrequencyCookie(cookies.DISMISSED,widget.id),ap3c.track({apiPath:"-/events/cw-event",cw:{widget_id:widget.id,type:"widget_dismissed",shown_on_url:window.location.href}})},hideFloatingButton:function(widget){for(var widgetTemplate=document.getElementById(widget.id+"-button"),widgetTemplateWrapper=widgetTemplate.children[0],index=0;index<widgetTemplateWrapper.children.length;index++)widgetTemplateWrapper.children[index].classList.length&&widgetTemplateWrapper.children[index].classList.remove("ap3w-show");setTimeout(function(){widgetTemplate.style.display="none"},TIMEOUT)},handleCountDown:function(countdown){var timer=countdown.dataset.timer,type=countdown.dataset.type,display=countdown.dataset.display,daysElement=document.querySelector(".ap3w-countdown__time-value-days"),hoursElement=document.querySelector(".ap3w-countdown__time-value-hours"),minsElement=document.querySelector(".ap3w-countdown__time-value-minutes"),secsElement=document.querySelector(".ap3w-countdown__time-value-seconds"),secondsLeft=timer;if("date"===type){var now=new Date,timerDate=new Date(timer);secondsLeft=(timerDate.getTime()-now.getTime())/1e3}this.countdownInterval=setInterval(function(){if((secondsLeft-=1)<1)secsElement&&(secsElement.innerText=0,secsElement.nextElementSibling.innerText="Secs"),clearInterval(this.countdownInterval);else{var timeleftObject=getTimeFromSeconds(secondsLeft,display);if(!secsElement)return void clearInterval(this.countdownInterval);secsElement.innerText=timeleftObject.seconds,1===timeleftObject.seconds?secsElement.nextElementSibling.innerText="Sec":secsElement.nextElementSibling.innerText="Secs",minsElement&&(minsElement.innerText=timeleftObject.minutes,1===timeleftObject.minutes?minsElement.nextElementSibling.innerText="Min":minsElement.nextElementSibling.innerText="Mins"),hoursElement&&(hoursElement.innerText=timeleftObject.hours,1===timeleftObject.hours?hoursElement.nextElementSibling.innerText="Hr":hoursElement.nextElementSibling.innerText="Hrs"),daysElement&&(daysElement.innerText=timeleftObject.days,1===timeleftObject.days?daysElement.nextElementSibling.innerText="Day":daysElement.nextElementSibling.innerText="Days")}},1e3)},injectVideo:function(widget,videoThumb,videoIframe){videoThumb.addEventListener("click",function(event){event.preventDefault(),videoThumb.style.display="none",videoIframe.src=videoThumb.dataset.videosrc,videoIframe.style.display="block",widget.frequency===frequencies.UNTIL_DIMISSED_OR_CONVERTED&&ap3c.setFrequencyCookie(cookies.CONVERTED,widget.id),ap3c.track({apiPath:"-/events/cw-event",cw:{widget_id:widget.id,type:"widget_video_watched",shown_on_url:window.location.href,attributes:{watched:videoThumb.dataset.videosrc}}})})},show:function(widget,templateName,delay){delay=void 0!==delay?delay:10;var hide=this.hide.bind(this),hideFloatingButton=this.hideFloatingButton.bind(this),show=this.show.bind(this),shouldntFadeIn=(this.copyToClipboard.bind(this),"bar"===widget.type&&widget.when&&"0"===widget.when.value),isSpinToWin="spin-to-win"===templateName;ap3c.injectCustomFonts(widget.font_urls);var widgetContainer=document.getElementById(widget.id);if(templateName)var widgetTemplate=document.getElementById(widget.id+"-"+templateName);else widgetTemplate=widgetContainer.children[0];var thankYouTemplate=document.getElementById(widget.id+"-thank-you"),outcomeTemplate=document.getElementById(widget.id+"-outcome"),overlays=document.querySelectorAll(".ap3w-overlay");setTimeout(function(){setTimeout(function(){for(var i=0;i<overlays.length;i++)overlays[i].classList.add("ap3w-show");if(thankYouTemplate)if(-1!==thankYouTemplate.children[0].className.indexOf("ap3w-wrapper"))for(i=0;i<thankYouTemplate.children[0].children.length;i++)thankYouTemplate.children[0].children[i].classList.add("ap3w-show");else for(i=0;i<thankYouTemplate.children.length;i++)thankYouTemplate.children[i].classList.add("ap3w-show");if(outcomeTemplate)for(i=0;i<outcomeTemplate.children.length;i++)outcomeTemplate.children[i].classList.add("ap3w-show")}),widgetContainer.style.display="block",widgetTemplate&&(widgetTemplate.style.display="flex",setTimeout(function(){for(var i=0;i<widgetTemplate.children.length;i++){if(widgetTemplate.children[i].classList.length&&(shouldntFadeIn?(widgetTemplate.children[widgetTemplate.children.length-1].classList.add("ap3w-dont-fade-in"),setTimeout(function(){widgetTemplate.children[widgetTemplate.children.length-1].classList.add("ap3w-show"),setTimeout(function(){widgetTemplate.children[widgetTemplate.children.length-1].classList.remove("ap3w-dont-fade-in")},50)})):widgetTemplate.children[i].classList.add("ap3w-show")),-1!==widgetTemplate.children[i].className.indexOf("ap3w-wrapper"))for(var wrapperChildren=widgetTemplate.children[0].children,j=0;j<wrapperChildren.length;j++)wrapperChildren[j].classList.length&&wrapperChildren[j].classList.add("ap3w-show");if(-1!==widgetTemplate.id.indexOf(widget.id+"-spin-to-win")){var spinTheWheelContentDivs=widgetTemplate.getElementsByClassName("ap3w-spin-the-wheel-content");spinTheWheelContentDivs&&spinTheWheelContentDivs.length&&spinTheWheelContentDivs[0].classList.add("ap3w-show")}}}));var floatingButtonTemplate=document.getElementById("ap3w-floating-button-"+widget.id);if(floatingButtonTemplate){floatingButtonTemplate.onmouseover=function(){hideFloatingButton(widget),setTimeout(function(){show(widget,"spin-to-win"),widgetContainer.style.pointerEvents="all";var spinTheWheelContentDivs=widgetContainer.getElementsByClassName("ap3w-spin-the-wheel-content");spinTheWheelContentDivs&&spinTheWheelContentDivs.length&&spinTheWheelContentDivs[0].classList.add("ap3w-show")},2*TIMEOUT)}}var acceptGDPRButton=document.getElementById("ap3w-gdpr-accept-"+widget.id)||widgetContainer.querySelector("#ap3w-gdpr-accept");acceptGDPRButton&&(acceptGDPRButton.onclick=function(){ap3c.track({accepted:!0,cw:{widget_id:widget.id,type:"widget_shown",shown_on_url:window.location.href}}),hide(widget,templateName)});for(var widgetTexts=document.getElementsByClassName("ap3w-text-"+widget.id),textIdx=0;textIdx<widgetTexts.length;textIdx++)for(var aTags=widgetTexts[textIdx].getElementsByTagName("a"),aIdx=0;aIdx<aTags.length;aIdx++)aTags[aIdx].onclick=function(e){e.target.href&&-1===e.target.href.indexOf(CLOSE_WIDGET)&&(widget.frequency===frequencies.UNTIL_DIMISSED_OR_CONVERTED&&ap3c.setFrequencyCookie(cookies.CONVERTED,widget.id),ap3c.track({apiPath:"-/events/cw-event",cw:{widget_id:widget.id,type:"widget_url_clicked",shown_on_url:window.location.href,attributes:{clicked:e.target.href}}}))};for(var widgetButtons=document.getElementsByClassName("ap3w-button-"+widget.id),buttonIdx=0;buttonIdx<widgetButtons.length;buttonIdx++)for(aTags=widgetButtons[buttonIdx].getElementsByTagName("a"),aIdx=0;aIdx<aTags.length;aIdx++)aTags[aIdx].onclick=function(e){""!==e.href&&(widget.frequency===frequencies.UNTIL_DIMISSED_OR_CONVERTED&&ap3c.setFrequencyCookie(cookies.CONVERTED,widget.id),ap3c.track({apiPath:"-/events/cw-event",cw:{widget_id:widget.id,type:"widget_url_clicked",shown_on_url:window.location.href,attributes:{clicked:e.target.href}}}))};switch(widget.frequency){case frequencies.ONCE_PER_SESSIONS_OR_UNTIL_CONVERTED:ap3c.setFrequencyCookie(cookies.SHOWN_IN_CURRENT_SESSION,widget.id,!0);break;case frequencies.ONLY_ONCE:ap3c.setFrequencyCookie(cookies.SHOWN,widget.id)}isSpinToWin||ap3c.track({apiPath:"-/events/cw-event",cw:{widget_id:widget.id,type:"widget_shown",shown_on_url:window.location.href}})},[delay])},showAfterSubmit:function(widget,originalTemplate,targetTemplate,embeddedContainer){var hide=this.hide.bind(this),injectVideo=this.injectVideo.bind(this),handleCountDown=this.handleCountDown.bind(this),setHeight=function(element,height){"form"!==widget.type&&(element.style.maxHeight=height+"px",element.style.height=height+"px")};if(embeddedContainer)originalTemplate=embeddedContainer.parentElement,targetTemplate=embeddedContainer.parentElement.nextElementSibling;else originalTemplate=document.getElementById(widget.id+"-"+originalTemplate),targetTemplate=document.getElementById(widget.id+"-"+targetTemplate);if(-1!==originalTemplate.children[0].className.indexOf("ap3w-wrapper")){var wrapperChildren=originalTemplate.children[0].children,originalHeight=wrapperChildren[wrapperChildren.length-1].offsetHeight;originalTemplate.innerHTML=targetTemplate.innerHTML;var newHeight=originalTemplate.children[0].children[originalTemplate.children[0].children.length-1].offsetHeight;setHeight(originalTemplate.children[0].children[originalTemplate.children[0].children.length-1],originalHeight),setTimeout(function(){setHeight(originalTemplate.children[0].children[originalTemplate.children[0].children.length-1],newHeight)})}else{originalHeight=originalTemplate.children[originalTemplate.children.length-1].offsetHeight;originalTemplate.innerHTML=targetTemplate.innerHTML;newHeight=originalTemplate.children[originalTemplate.children.length-1].offsetHeight;setHeight(originalTemplate.children[originalTemplate.children.length-1],originalHeight),setTimeout(function(){setHeight(originalTemplate.children[originalTemplate.children.length-1],newHeight)})}var surveyFeedbackForm=document.getElementById("ap3w-survey-feedback-form-"+widget.id);surveyFeedbackForm&&surveyFeedbackForm.addEventListener("submit",function(event){event.preventDefault();var formSubmitButton=document.getElementById("ap3w-input-submit-"+widget.id),formTextArea=document.getElementById("ap3w-input-textarea-"+widget.id),buttonOnClick=formSubmitButton.dataset.buttonOnClick,buttonSubmitUrl=formSubmitButton.dataset.buttonSubmitUrl;formTextArea.value&&ap3c.track({apiPath:"-/events/survey-feedback",cw:{widget_id:widget.id,type:"widget_survey_feedback",shown_on_url:window.location.href,attributes:{feedback:formTextArea.value}}}),"go-to-url"===buttonOnClick?window.location.assign(buttonSubmitUrl):hide(widget,"thank-you")});var videoThumb=document.querySelector("#ap3w-video-thumbnail--inner-"+widget.id),videoIframe=document.querySelector("#ap3w-youtube-video-"+widget.id);videoThumb&&videoIframe&&injectVideo(widget,videoThumb,videoIframe);var countdown=document.querySelector("#ap3w-countdown-"+widget.id);countdown&&handleCountDown(countdown)},spinTheWheel:function(widget,response,widgetContainer){var showAfterSubmit=this.showAfterSubmit.bind(this),needleContainerDiv=document.getElementById("needle-container-"+widget.id),descriptionTextDiv=widgetContainer.querySelector("#selected-ap3w-spin-the-wheel-description-text"),copyCodeButtonDiv=widgetContainer.querySelector("#selected-ap3w-spin-the-wheel-copy-button"),couponDiv=document.getElementById("ap3w-wheel-coupon-"+widget.id),couponCodeText=document.getElementById("ap3w-coupon-code-text-"+widget.id),spinTheWheelContentDivs=widgetContainer.getElementsByClassName("ap3w-spin-the-wheel-content"),rotatingContentDivs=widgetContainer.getElementsByClassName("ap3w-wheel--rotating-content");if(response&&!response.error&&response.code)var code=response.code,discount=response.discount,title=(description=discount&&discount.description,discount&&discount.title);else var description="<h2>Thereâ€™s been an error. Please try again soon.</h2>";discount&&code?couponCodeText?couponCodeText.innerText=code:couponDiv.innerText=code:(couponDiv.parentNode.remove(),copyCodeButtonDiv.remove()),description?descriptionTextDiv.firstChild.innerHTML=description:descriptionTextDiv.remove();for(var spinLabels=Array.prototype.slice.call(widgetContainer.getElementsByClassName("ap3w-wheel--coupon-label")),selectedDiscountIndex=0,i=0;i<8;i++)if(spinLabels[i].innerHTML===title){selectedDiscountIndex=i;break}var targetSpin=0-(1800+[0,45,90,135,180,225,270,315][selectedDiscountIndex]),spinDegrees=targetSpin,currentSpin=0;rotatingContentDivs[0].classList.add("ap3w-spinning");var interval=setInterval(function(){if(spinDegrees<0){-.5<spinDegrees?spinDegrees=0:currentSpin=targetSpin-(spinDegrees/=1.005),rotatingContentDivs[0].style.transform="rotate("+currentSpin+"deg)";var fixed45Spin=Math.abs(currentSpin%45);if(START_NEEDLE_MOVE_ANGLE<fixed45Spin&&fixed45Spin<END_NEEDLE_MOVE_ANGLE){var degrees=BASE_NEEDLE_ANGLE+(fixed45Spin-START_NEEDLE_MOVE_ANGLE)*NEEDLE_ANGLE_INCREMENT;needleContainerDiv.style.transform="rotate("+degrees+"deg)"}else needleContainerDiv.style.transform="rotate("+BASE_NEEDLE_ANGLE+"deg)"}else clearInterval(interval),spinTheWheelContentDivs[0].classList.remove("ap3w-show"),setTimeout(function(){rotatingContentDivs[0].classList.remove("ap3w-spinning"),rotatingContentDivs[1].style.transform=rotatingContentDivs[0].style.transform,showAfterSubmit(widget,"spin-to-win","outcome"),spinTheWheelContentDivs[0].classList.add("ap3w-show")},TIMEOUT)},5)},injectEmbeddableForm:function(widget,reprocessEmbeddedForm){var ttl=this.ttl,selectedOptions={},showAfterSubmit=this.showAfterSubmit.bind(this),getFormFieldsData=ap3c.getFormFieldsData.bind(this);ap3c.injectCustomFonts(widget.font_urls);var embeddableForms=document.querySelectorAll("#ap3w-embeddable-form-"+widget.id);if(embeddableForms&&embeddableForms.length){for(var formIndex=0;formIndex<embeddableForms.length;formIndex++){for(var embeddableForm=embeddableForms[formIndex],isUnstyled="style"!==embeddableForm.firstElementChild.nodeName.toLowerCase(),inputs=embeddableForm.getElementsByTagName("input"),i=0;i<inputs.length;i++)"tel"==inputs[i].type.toLowerCase()&&(-1!=inputs[i].className.indexOf("ap3w-input-areacode")&&ap3c.country_code&&(inputs[i].value="+"+ap3c.country_code),inputs[i].addEventListener("input",function(){this.value=this.value.replace(/[^0-9+]/g,"")}));var allDescendants=embeddableForm.getElementsByTagName("*");if(!isUnstyled&&allDescendants&&allDescendants.length)for(var j=0;j<allDescendants.length;j++){var descendant=allDescendants[j];if(descendant.classList&&descendant.classList.length)for(var k=0;k<descendant.classList.length;k++)-1===descendant.classList[k].indexOf("ap3w")&&descendant.classList.remove(descendant.classList[k])}var inputSelectLists=embeddableForm.querySelectorAll("#ap3w-input-select-list-"+widget.id);if(inputSelectLists&&inputSelectLists.length)for(j=0;j<inputSelectLists.length;j++){var selectList=inputSelectLists[j],randomId=Math.random().toString(36).slice(-10),selectListId=selectList.dataset.listId+randomId;selectList.dataset.newListId=selectListId;var selectFields=selectList.children,selectListContainer=selectList.parentNode;if(!isUnstyled&&3!==selectListContainer.children.length)for(k=0;k<selectListContainer.children.length;k++)selectListContainer.children[k].className&&-1!==selectListContainer.children[k].className.indexOf("ap3w")||selectListContainer.children[k].remove();if(selectFields&&selectFields.length)for(var selectFieldIndex=0;selectFieldIndex<selectFields.length;selectFieldIndex++)selectFields[selectFieldIndex].addEventListener("click",function(event){var clickedOption=event.target.closest(".ap3w-form-input-select-option"),clickedValue=clickedOption.dataset.value,selectList=clickedOption.parentElement,selectListTrigger=selectList.previousElementSibling,triggerPlaceholderText=selectListTrigger.dataset.placeholder,selectListId=selectList.dataset.newListId;"multi_select"===selectList.dataset.selectType?(selectedOptions[selectListId]?-1===selectedOptions[selectListId].indexOf(clickedValue)?(selectedOptions[selectListId].push(clickedValue),clickedOption.firstElementChild.checked=!0,clickedOption.classList.add("ap3w-form-input-select-option-selected")):(selectedOptions[selectListId].splice(selectedOptions[selectListId].indexOf(clickedValue),1),clickedOption.firstElementChild.checked=!1,clickedOption.classList.remove("ap3w-form-input-select-option-selected")):(selectedOptions[selectListId]=[clickedValue],clickedOption.firstElementChild.checked=!0,clickedOption.classList.add("ap3w-form-input-select-option-selected")),selectedOptions[selectListId].length?(selectListTrigger.innerText=selectedOptions[selectListId].join(", "),selectListTrigger.value=selectedOptions[selectListId]):(selectListTrigger.innerText=triggerPlaceholderText,selectListTrigger.value=triggerPlaceholderText)):(selectedOptions[selectListId]=clickedValue,selectList.classList.add("ap3w-form-input-select-list-hide"),selectListTrigger.innerText=selectedOptions[selectListId],selectListTrigger.value=selectedOptions[selectListId])})}embeddableForm.addEventListener("submit",function(event){event.preventDefault();var embeddableForm=event.target,embeddedContainer=embeddableForm.parentElement,emailInput=embeddableForm.querySelector("#ap3w-form-input-email-"+widget.id),phoneInput=embeddableForm.querySelector("#ap3w-input-phone-"+widget.id),firstNameInput=embeddableForm.querySelector('[data-field-id="str::first"] #ap3w-form-input-text-'+widget.id),firstNameValue=void 0;firstNameInput&&firstNameInput.value&&(firstNameValue=firstNameInput.value);var lastNameInput=embeddableForm.querySelector('[data-field-id="str::first"] #ap3w-form-input-text-'+widget.id),lastNameValue=void 0;if(lastNameInput&&lastNameInput.value&&(lastNameValue=lastNameInput.value),emailInput||phoneInput){var email=emailInput&&emailInput.value,phone=phoneInput&&phoneInput.value;if(email||phone){for(var fields=getFormFieldsData(widget,"ap3w-form-input",selectedOptions,embeddableForm),i=0;i<fields.length;i++)if("true"===fields[i].required&&(void 0===fields[i].value||0===fields[i].value.length))return;embeddableForm[widget.id]||(ap3c.track({apiPath:"-/events/cw-event",email:email,first:firstNameValue,last:lastNameValue,cw:{widget_id:widget.id,type:"widget_form_submitted",shown_on_url:window.location.href,attributes:fields,rc:ap3c.recaptcha}}),embeddableForm[widget.id]=!0),localStorage.setItem(this.localStorageKey+widget.id,JSON.stringify({expiry:(new Date).getTime()+ttl})),widget.frequency===frequencies.UNTIL_DIMISSED_OR_CONVERTED&&ap3c.setFrequencyCookie(cookies.CONVERTED,widget.id);var embedFormButton=embeddableForm.querySelector("#ap3w-form-button-"+widget.id),buttonSubmitUrl=embedFormButton.dataset.buttonSubmitUrl;"go-to-url"===embedFormButton.dataset.buttonOnClick?window.location.assign(buttonSubmitUrl):showAfterSubmit(widget,"form","thank-you",embeddedContainer)}}})}reprocessEmbeddedForm||ap3c.track({apiPath:"-/events/cw-event",cw:{widget_id:widget.id,type:"widget_shown",shown_on_url:window.location.href}}),this.selectInputsInitialized||(document.addEventListener("click",function(event){var selectLists=document.getElementsByClassName("ap3w-form-input-select-list");if("ap3w-form-input-select-button"===event.target.className)event.target.nextElementSibling&&event.target.nextElementSibling.classList.toggle("ap3w-form-input-select-list-hide");else if(!event.target.closest(".ap3w-form-input-select-option")&&selectLists&&selectLists.length)for(var i=0;i<selectLists.length;i++)selectLists[i].classList.add("ap3w-form-input-select-list-hide")}),this.selectInputsInitialized=!0)}},inject:function(widget,hasLogo){var shownWidget=!1,show=this.show.bind(this),getFormFieldsData=ap3c.getFormFieldsData.bind(this),showAfterSubmit=this.showAfterSubmit.bind(this),spinTheWheel=this.spinTheWheel.bind(this),handleCountDown=this.handleCountDown.bind(this),injectVideo=this.injectVideo.bind(this),ttl=this.ttl,selectedOptions={},hide=this.hide.bind(this),copyToClipboard=this.copyToClipboard.bind(this),existingWidgetContainer=document.getElementById(widget.id);if(!existingWidgetContainer){var container=document.getElementsByTagName(widget.use_slot)[0],widgetContainer=document.createElement("div");if(widgetContainer.innerHTML=widget.html,widgetContainer.firstChild&&(widgetContainer.firstChild.style.bottom=0,widgetContainer.firstChild.style.top=0,widgetContainer.firstChild.style.right=0,widgetContainer.firstChild.style.left=0,widget.is_gdpr&&(widgetContainer.firstChild.style.zIndex=99999)),widget.style&&"top"===widget.style.position&&(widgetContainer.style.position="relative",widget.style.sticky&&(widgetContainer.style.position="sticky"),widgetContainer.style.zIndex=99999),existingWidgetContainer||container.insertAdjacentElement("afterbegin",widgetContainer),widget.when)if("load"===widget.when.selection)show(widget,"",10);else if("on"===widget.when.selection)show(widget,"",1e3*widget.when.value);else if("click"===widget.when.selection)document.addEventListener("click",function(e){e.target.closest(widget.when.value)&&show(widget,"",10)});else if("scroll"===widget.when.selection)window.onscroll=function(){!shownWidget&&window&&document.body&&(100*((window.innerHeight+window.scrollY)/document.body.scrollHeight)>widget.when.value&&(show(widget,"",10),shownWidget=!0))};else if("exit"===widget.when.selection){var exitIntentCallback=function(e){!e.toElement&&!e.relatedTarget&&e.clientY<10&&(document.removeEventListener("mouseout",exitIntentCallback),e.preventDefault(),show(widget,"",10))};document.addEventListener("mouseout",exitIntentCallback)}else show(widget,"",2e3);var couponButton=document.getElementById("ap3w-coupon-button-"+widget.id),couponCode=document.getElementById("ap3w-coupon-code-"+widget.id),couponCodeText=document.getElementById("ap3w-coupon-code-text-"+widget.id);couponButton&&couponCode&&couponButton.addEventListener("click",function(event){event.preventDefault();var discountId=event.target.dataset.discountId;discountId&&ap3c.track({apiPath:"-/events/generate-simple-coupon",cw:{widget_id:widget.id,type:"widget_coupon_generated",shown_on_url:window.location.href},discount_id:discountId},function(response){couponCodeText?couponCodeText.innerText=response.code:couponCode.innerText=response.code,localStorage.setItem("ap_capture_widgets"+widget.id,JSON.stringify({expiry:(new Date).getTime()+ttl})),showAfterSubmit(widget,"greeting","thank-you")})});var submitFormCallback=function(response){response.code&&(couponCodeText?couponCodeText.innerText=response.code:couponCode.innerText=response.code),showAfterSubmit(widget,"greeting","thank-you")};if(couponCode)var discountId=couponCode.dataset.discountId;var form=document.getElementById("ap3w-form-"+widget.id);if(form){for(var inputs=document.getElementsByTagName("input"),i=0;i<inputs.length;i++)"tel"==inputs[i].type.toLowerCase()&&(-1!=inputs[i].className.indexOf("ap3w-input-areacode")&&ap3c.country_code&&(inputs[i].value="+"+ap3c.country_code),inputs[i].addEventListener("input",function(){this.value=this.value.replace(/[^0-9+]/g,"")}));form.addEventListener("submit",function(event){event.preventDefault();var emailInput=document.getElementById("ap3w-input-email-"+widget.id),phoneInput=document.getElementById("ap3w-input-phone-"+widget.id),firstNameInput=form.querySelector('[data-field-id="str::first"] #ap3w-input-text-'+widget.id),firstNameValue=void 0;firstNameInput&&firstNameInput.value&&(firstNameValue=firstNameInput.value);var lastNameInput=form.querySelector('[data-field-id="str::last"] #ap3w-input-text-'+widget.id),lastNameValue=void 0;lastNameInput&&lastNameInput.value&&(lastNameValue=lastNameInput.value);var email=emailInput&&emailInput.value,phone=phoneInput&&phoneInput.value;if(email||phone){for(var fields=getFormFieldsData(widget,"ap3w-input",selectedOptions,form),i=0;i<fields.length;i++)if("true"===fields[i].required&&(!fields[i].value||0===fields[i].value.length))return;var isSpinTheWheel=document.getElementById(widget.id+"-spin-to-win"),formSubmitButton=document.getElementById("ap3w-input-submit-"+widget.id);if(isSpinTheWheel){var baseSpin=0,rotatingContentDivs=widgetContainer.getElementsByClassName("ap3w-wheel--rotating-content"),needleContainerDiv=document.getElementById("needle-container-"+widget.id);emailInput&&(emailInput.disabled=!0),phoneInput&&(phoneInput.disabled=!0),formSubmitButton.value="Spinning...",formSubmitButton.disabled=!0,rotatingContentDivs[0].classList.add("ap3w-spinning");var apiAwaitInterval=setInterval(function(){baseSpin-=11,rotatingContentDivs[0].style.transform="rotate("+baseSpin+"deg)";var fixed45Spin=Math.abs(baseSpin%45);if(START_NEEDLE_MOVE_ANGLE<fixed45Spin&&fixed45Spin<END_NEEDLE_MOVE_ANGLE){var degrees=BASE_NEEDLE_ANGLE+(fixed45Spin-START_NEEDLE_MOVE_ANGLE)*NEEDLE_ANGLE_INCREMENT;needleContainerDiv.style.transform="rotate("+degrees+"deg)"}else needleContainerDiv.style.transform="rotate("+BASE_NEEDLE_ANGLE+"deg)"},5);widget.frequency===frequencies.UNTIL_DIMISSED_OR_CONVERTED&&ap3c.setFrequencyCookie(cookies.CONVERTED,widget.id),ap3c.track({apiPath:"-/events/spin-the-wheel",email:email,first:firstNameValue,last:lastNameValue,widget_id:widget.id,cw:{widget_id:widget.id,type:"widget_spin_submitted",shown_on_url:window.location.href,attributes:fields}},function(response){clearInterval(apiAwaitInterval),spinTheWheel(widget,response,widgetContainer)})}else if(discountId)widget.frequency===frequencies.UNTIL_DIMISSED_OR_CONVERTED&&ap3c.setFrequencyCookie(cookies.CONVERTED,widget.id),ap3c.track({apiPath:"-/events/cw-event",email:email,first:firstNameValue,last:lastNameValue,cw:{widget_id:widget.id,type:"widget_form_submitted",shown_on_url:window.location.href,attributes:fields,rc:ap3c.recaptcha},discount_id:discountId},submitFormCallback);else{ap3c.track({apiPath:"-/events/cw-event",email:email,first:firstNameValue,last:lastNameValue,cw:{widget_id:widget.id,type:"widget_form_submitted",shown_on_url:window.location.href,attributes:fields,rc:ap3c.recaptcha}});var buttonOnClick=formSubmitButton.dataset.buttonOnClick,buttonSubmitUrl=formSubmitButton.dataset.buttonSubmitUrl;widget.frequency===frequencies.UNTIL_DIMISSED_OR_CONVERTED&&ap3c.setFrequencyCookie(cookies.CONVERTED,widget.id),"go-to-url"===buttonOnClick?window.location.assign(buttonSubmitUrl):showAfterSubmit(widget,"greeting","thank-you")}localStorage.setItem(this.localStorageKey+widget.id,JSON.stringify({expiry:(new Date).getTime()+ttl}))}})}var sayThankYouButton=document.getElementById("ap3w-button-thank-you-"+widget.id);sayThankYouButton&&sayThankYouButton.addEventListener("click",function(event){event.preventDefault(),showAfterSubmit(widget,"greeting","thank-you")});var survey=document.getElementById("ap3w-survey-"+widget.id);survey&&survey.addEventListener("submit",function(event){event.preventDefault();var surveyResponse=event.submitter.innerText;discountId?ap3c.track({apiPath:"-/events/cw-event",cw:{widget_id:widget.id,type:"widget_survey_responded",shown_on_url:window.location.href,attributes:{response:surveyResponse}},discount_id:discountId},submitFormCallback):(ap3c.track({apiPath:"-/events/cw-event",cw:{widget_id:widget.id,type:"widget_survey_responded",shown_on_url:window.location.href,attributes:{response:surveyResponse}}}),showAfterSubmit(widget,"greeting","thank-you")),widget.frequency===frequencies.UNTIL_DIMISSED_OR_CONVERTED&&ap3c.setFrequencyCookie(cookies.CONVERTED,widget.id),localStorage.setItem(this.localStorageKey+widget.id,JSON.stringify({expiry:(new Date).getTime()+ttl}))});var videoThumb=container.querySelector("#ap3w-video-thumbnail--inner-"+widget.id),videoIframe=container.querySelector("#ap3w-youtube-video-"+widget.id);videoThumb&&videoIframe&&injectVideo(widget,videoThumb,videoIframe);var inputSelectOptions=document.getElementsByClassName("ap3w-input-select-option-"+widget.id);if(inputSelectOptions&&inputSelectOptions.length)for(var j=0;j<inputSelectOptions.length;j++)inputSelectOptions[j].addEventListener("click",function(event){var clickedOption=event.target.closest(".ap3w-input-select-option"),clickedValue=clickedOption.dataset.value,selectList=clickedOption.parentElement,selectListTrigger=selectList.previousElementSibling,triggerPlaceholderText=selectListTrigger.dataset.placeholder,selectListId=selectList.dataset.listId;"multi_select"===selectList.dataset.selectType?(selectedOptions[selectListId]?-1===selectedOptions[selectListId].indexOf(clickedValue)?(selectedOptions[selectListId].push(clickedValue),clickedOption.firstElementChild.checked=!0,clickedOption.classList.add("ap3w-input-select-option-selected")):(selectedOptions[selectListId].splice(selectedOptions[selectListId].indexOf(clickedValue),1),clickedOption.firstElementChild.checked=!1,clickedOption.classList.remove("ap3w-input-select-option-selected")):(selectedOptions[selectListId]=[clickedValue],clickedOption.firstElementChild.checked=!0,clickedOption.classList.add("ap3w-input-select-option-selected")),selectedOptions[selectListId].length?(selectListTrigger.innerText=selectedOptions[selectListId].join(", "),selectListTrigger.value=selectedOptions[selectListId]):(selectListTrigger.innerText=triggerPlaceholderText,selectListTrigger.value=triggerPlaceholderText)):(selectedOptions[selectListId]=clickedValue,selectList.classList.add("ap3w-input-select-list-hide"),selectListTrigger.innerText=selectedOptions[selectListId],selectListTrigger.value=selectedOptions[selectListId])});var reaction=document.getElementById("ap3w-reaction-"+widget.id);reaction&&reaction.addEventListener("submit",function(event){event.preventDefault();var submittedReaction=event.submitter.dataset.reaction;discountId?ap3c.track({apiPath:"-/events/cw-event",cw:{widget_id:widget.id,type:"widget_reacted",shown_on_url:window.location.href,attributes:{reaction:submittedReaction,reaction_reason:""}},discount_id:discountId},submitFormCallback):(ap3c.track({apiPath:"-/events/cw-event",cw:{widget_id:widget.id,type:"widget_reacted",shown_on_url:window.location.href,attributes:{reaction:submittedReaction,reaction_reason:""}}}),showAfterSubmit(widget,"greeting","thank-you")),widget.frequency===frequencies.UNTIL_DIMISSED_OR_CONVERTED&&ap3c.setFrequencyCookie(cookies.CONVERTED,widget.id),localStorage.setItem(this.localStorageKey+widget.id,JSON.stringify({expiry:(new Date).getTime()+ttl}))});var poweredByAutopilotLogos=document.getElementsByClassName("ap3w-powered-by-autopilot");if(!hasLogo&&poweredByAutopilotLogos&&0<poweredByAutopilotLogos.length)for(i=0;i<poweredByAutopilotLogos.length;i++)poweredByAutopilotLogos[i].remove();var countdown=container.querySelector("#ap3w-countdown-"+widget.id);countdown&&handleCountDown(countdown),document.getElementById(widget.id).addEventListener("click",function(event){var selectLists=document.getElementsByClassName("ap3w-input-select-list");if(event.target.closest("#ap3w-input-select-button-"+widget.id))for(var listId=event.target.closest("#ap3w-input-select-button-"+widget.id).nextElementSibling.dataset.listId,i=0;i<selectLists.length;i++)selectLists[i].dataset.listId!==listId?selectLists[i].classList.add("ap3w-input-select-list-hide"):selectLists[i].classList.toggle("ap3w-input-select-list-hide");else if(!event.target.closest(".ap3w-input-select-option")&&selectLists&&selectLists.length)for(i=0;i<selectLists.length;i++)selectLists[i].classList.add("ap3w-input-select-list-hide");if(event.target.id==="ap3w-coupon-code-copy-"+widget.id){clearInterval(this.countdownInterval);var couponCode=event.target.previousElementSibling&&event.target.previousElementSibling.innerText;couponCode&&copyToClipboard(couponCode)}if(event.target.closest("#ap3w-close-"+widget.id)||event.target.closest("#ap3w-button-close-"+widget.id)||event.target.closest("#ap3w-close-"+widget.id+"--circle")||event.target.closest("#ap3w-close--circle-"+widget.id)||event.target.closest(".ap3w-link-close")||event.target.href&&-1!==event.target.href.indexOf(CLOSE_WIDGET)){if(event.preventDefault(),document.querySelector(".ap3w-spinning")||(clearInterval(this.countdownInterval),hide(widget,"")),"selected-ap3w-spin-the-wheel-copy-button"===event.target.parentElement.id){clearInterval(this.countdownInterval);var couponDiv=document.getElementById("ap3w-wheel-coupon-"+widget.id),couponCodeText=document.getElementById("ap3w-coupon-code-text-"+widget.id);if(couponCodeText)var spinTheWheelCouponCode=couponCodeText.innerText;else if(couponDiv)spinTheWheelCouponCode=couponDiv.innerText;spinTheWheelCouponCode&&copyToClipboard(spinTheWheelCouponCode)}}else event.target.closest(".ap3w-close-gdpr")&&widget.is_gdpr&&(clearInterval(this.countdownInterval),hide(widget,""))})}}},ap3c._shopifySubscribeAction={canExecute:function(){return!!window.Shopify},execute:function(){var handleSubscribe=function(){var formElements=document.getElementsByClassName("contact-form");if(formElements&&0<formElements.length)for(var i=0;i<formElements.length;i++)!function(formElement){formElement.addEventListener("submit",function(e){var email=new FormData(formElement).get("contact[email]");email&&ap3c.track({v:0,email:email})})}(formElements[i])};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){handleSubscribe()}):handleSubscribe()}},ap3c._shopifyProductViewedAction={canExecute:function(){return!!(window.Shopify&&window.ShopifyAnalytics&&window.ShopifyAnalytics.meta&&window.ShopifyAnalytics.meta.product)},execute:function(){ap3c.payloadEnrichers.push(function(payload,options){return payload.sh=options&&options.sh||{event_type:"product_viewed",shop:window.Shopify.shop,currency:window.ShopifyAnalytics.currency,product_id:window.ShopifyAnalytics.meta.product.id,selected_variant_id:ap3c.getShopifyProductCurrentVariantId()},payload})}},ap3c._shopifyProductAddedToCartAction={canExecute:function(){return!!(window.Shopify&&window.ShopifyAnalytics&&window.ShopifyAnalytics.meta&&window.ShopifyAnalytics.meta.product)},execute:function(){var trackAddToCart=function(){ap3c.track({apiPath:"-/events/sh-event",v:0,email:ap3c.shopifyLiquidEmail,sh:{event_type:"product_added_to_cart",shop:window.Shopify.shop,currency:window.ShopifyAnalytics.currency,product_id:window.ShopifyAnalytics.meta.product.id,selected_variant_id:ap3c.getShopifyProductCurrentVariantId()}})};if(window.fetch){var fetch=window.fetch;window.fetch=function(resource,options){return options&&"POST"===options.method&&"/cart/add.js"===resource?Promise.resolve(fetch.apply(window,arguments).then(function(response){return 200===response.status&&trackAddToCart(),response})):Promise.resolve(fetch.apply(window,arguments))}}var open=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(method,url){return"POST"===method&&"/cart/add.js"===url&&this.addEventListener("readystatechange",function(){4===this.readyState&&200===this.status&&trackAddToCart()}),open.apply(this,arguments)}}},ap3c._shopifyWaitingOnStockWidget={ttl:2592e6,localStorageKey:"ap_waiting_on_stock",canExecute:function(widget){if(!(window.Shopify&&window.ShopifyAnalytics&&window.ShopifyAnalytics.meta&&window.ShopifyAnalytics.meta.product))return!1;var data=localStorage.getItem(this.localStorageKey+window.ShopifyAnalytics.meta.product.id+ap3c.getShopifyProductCurrentVariantId());if(data){var item=JSON.parse(data);if((new Date).getTime()<item.expiry)return ap3c._generalWidget.hide(widget),!1}return!0},execute:function(widget){var inject=this.inject.bind(this);if(window.fetch){var fetch=window.fetch;window.fetch=function(resource,options){return options&&"POST"===options.method&&"/cart/add.js"===resource?Promise.resolve(fetch.apply(window,arguments).then(function(response){return 422===response.status?ap3c._generalWidget.show(widget):ap3c._generalWidget.hide(widget),response})):Promise.resolve(fetch.apply(window,arguments))}}var open=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(method,url){return"POST"===method&&"/cart/add.js"===url&&this.addEventListener("readystatechange",function(){4===this.readyState&&422===this.status?ap3c._generalWidget.show(widget):ap3c._generalWidget.hide(widget)}),open.apply(this,arguments)},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){inject(widget)}):inject(widget)},inject:function(widget){ap3c.getFormFieldsData.bind(this);var container=document.getElementsByTagName(widget.use_slot)[0],widgetContainer=document.createElement("div");widgetContainer.innerHTML=widget.html,widgetContainer.firstChild&&widgetContainer.firstChild.style&&(widgetContainer.firstChild.style.bottom=0,widgetContainer.firstChild.style.top=0,widgetContainer.firstChild.style.right=0,widgetContainer.firstChild.style.left=0),container.appendChild(widgetContainer);var data=localStorage.getItem(this.localStorageKey+window.ShopifyAnalytics.meta.product.id+ap3c.getShopifyProductCurrentVariantId());if(data){var item=JSON.parse(data);(new Date).getTime()<item.expiry&&ap3c._generalWidget.hide(widget)}else"false"===ap3c.shopifyIsProductAvailable?ap3c._generalWidget.show(widget):ap3c.shopifyIsProductVariantAvailableMap&&!1===ap3c.shopifyIsProductVariantAvailableMap[ap3c.getShopifyProductCurrentVariantId()]?ap3c._generalWidget.show(widget):ap3c._generalWidget.hide(widget);var ttl=this.ttl,localStorageKey=this.localStorageKey,form=document.getElementById("ap3w-form-"+widget.id);form&&(form.addEventListener("submit",function(event){event.preventDefault();var emailInput=document.getElementById("ap3w-input-email-"+widget.id),email=emailInput.value;if(email){var fields=[{field_id:"str::email",value:email,merge_strategy:"override"}];ap3c.track({apiPath:"-/events/cw-event",email:email,cw:{widget_id:widget.id,type:"widget_form_submitted",shown_on_url:window.location.href,attributes:fields}}),ap3c.track({apiPath:"-/events/sh-event",v:0,email:email,sh:{widget_id:widget.id,event_type:"product_waiting_on_stock",shop:window.Shopify.shop,currency:window.ShopifyAnalytics.currency,product_id:window.ShopifyAnalytics.meta.product.id,selected_variant_id:ap3c.getShopifyProductCurrentVariantId()}}),localStorage.setItem(localStorageKey+window.ShopifyAnalytics.meta.product.id+ap3c.getShopifyProductCurrentVariantId(),JSON.stringify({expiry:(new Date).getTime()+ttl}))}ap3c._generalWidget.showAfterSubmit(widget,"greeting","thank-you"),emailInput.value=""}),document.getElementById(widget.id).addEventListener("click",function(event){(event.target.closest("#ap3w-close-"+widget.id)||event.target.closest("#ap3w-button-close-"+widget.id)||event.target.closest("#ap3w-close-"+widget.id+"--circle")||event.target.closest("#ap3w-close--circle-"+widget.id)||event.target.closest(".ap3w-link-close")||event.target.href&&-1!==event.target.href.indexOf(CLOSE_WIDGET))&&(event.preventDefault(),ap3c._generalWidget.hide(widget))}))}};for(var i=0;i<ap3c.cmd.length;i++)try{ap3c.cmd[i]()}catch(error){console.log(error)}var polyfillDateInput=function(){var featureDetectEl=document.createElement("input");try{featureDetectEl.type="date"}finally{if("date"!==featureDetectEl.type){var script=document.createElement("script");script.src="https://cdn.jsdelivr.net/npm/configurable-date-input-polyfill@2.8.2/configurable-date-input-polyfill.dist.min.js",document.body.appendChild(script);var styleSheet=document.createElement("style");styleSheet.type="text/css",styleSheet.innerText="date-input-polyfill[data-open=true] { z-index: 9999999; }",document.head.appendChild(styleSheet)}}};polyfillDateInput();